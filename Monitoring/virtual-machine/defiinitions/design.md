# 監視設計

## ビジネス
取得されたデータ件数をログとして記録する。  
記録したログは可視化を行う。  

ただし、どちらかというとデータ解析基盤で行うことなんので、  
今回の勉強範囲としては対象外とする。  

## サービス
1分ごとに`/users/limit`に対してアクセスし、下記の二点を監視する。  
- `200 OK`が返ってくるか
- レスポンスが1秒以内に帰ってくるか

上記のいずれかを満たさない場合は異常とし、5回連続で異常となった場合はアラートとして扱う。  

## サーバ
### 共通
1分ごとに下記のOSメトリクスを収集する。  

- CPU
  - Load Average
  - CPU使用率
- ハードディスク
  - IO
  - 使用量
- メモリ
  - 使用量
  - スワップ

収集したメトリクスのうち下記の条件を満たした場合はアラートとして扱う。  
- ハードディスクの使用量が残り10%未満になった場合
- ハードディスクの使用量が1分間で5%以上上昇した場合

### Web
1分ごとに下記のメトリクスを収集する。
- アクセス
  - アクセス数
  - 平均レスポンス時間
- ワーカー数

### AP
1分ごとに下記のメトリクスを収集する。
- ヒープメモリ
- スレッド数
- GC

### DB
1分ごとに下記のメトリクスを収集する。
- コネクション数
- スロークエリ発生数
